server:
  port: 8088
  tomcat:
    threads:
      max: 200              # 增加Tomcat线程数
      min-spare: 10
    max-connections: 10000  # 增加最大连接数
    accept-count: 100

spring:
  batch:
    jdbc:
      initialize-schema: embedded
    job:
      enabled: false

  datasource:
    dynamic:
      primary: master
      strict: false
      hikari:
        # 生产环境连接池配置（优化版）
        maximum-pool-size: 30        # 增加到30
        minimum-idle: 10             # 增加到10
        connection-timeout: 60000    # 60秒
        idle-timeout: 600000         # 10分钟
        max-lifetime: 1800000        # 30分钟
        connection-test-query: SELECT 1

      datasource:
        # 源数据库 - SQL Server
        master:
          driver-class-name: com.microsoft.sqlserver.jdbc.SQLServerDriver
          url: jdbc:sqlserver://10.5.80.179:1433;databaseName=OctOBackFT_1231;encrypt=true;trustServerCertificate=true
          username: pleung
          password: 123456
          hikari:
            maximum-pool-size: 20    # 读取数据，适度增加
            minimum-idle: 10
            connection-timeout: 60000
            # SQL Server特定优化
            data-source-properties:
              cachePrepStmts: true
              prepStmtCacheSize: 250
              prepStmtCacheSqlLimit: 2048

        # 目标数据库 - Oracle
        oracle:
          driver-class-name: oracle.jdbc.OracleDriver
          url: jdbc:oracle:thin:@//10.11.198.16:1721/MSEUZ
          username: JTQAMSSAPP
          password: JTQAMSSAPP!
          hikari:
            maximum-pool-size: 25    # 写入较多，增加连接数
            minimum-idle: 10
            connection-timeout: 60000
            # Oracle特定优化
            data-source-properties:
              oracle.jdbc.defaultBatchValue: 2000  # 批量操作大小
              oracle.net.CONNECT_TIMEOUT: 60000
              oracle.jdbc.ReadTimeout: 300000      # 5分钟读取超时

# MyBatis Plus 生产环境配置
mybatis-plus:
  configuration:
    # 生产环境关闭SQL日志输出，提升性能
    log-impl: org.apache.ibatis.logging.nologging.NoLoggingImpl
    # 批量操作优化
    default-executor-type: SIMPLE
    # 缓存配置
    cache-enabled: true
    lazy-loading-enabled: false
    aggressive-lazy-loading: false
    # 超时配置
    default-statement-timeout: 300  # 5分钟
  global-config:
    db-config:
      # 批量插入大小
      batch-size: 2000

# 日志配置 - 生产环境
logging:
  level:
    root: INFO
    org.example: INFO
    org.springframework.batch: INFO
    # 生产环境减少日志输出
    com.baomidou.dynamic: WARN
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: logs/application.log
    max-size: 100MB
    max-history: 30

# ==========================================
# JVM参数建议
# ==========================================
# -Xms4g                    # 初始堆内存4GB
# -Xmx8g                    # 最大堆内存8GB
# -XX:+UseG1GC              # 使用G1垃圾收集器
# -XX:MaxGCPauseMillis=200  # GC暂停时间目标
# -XX:+HeapDumpOnOutOfMemoryError
# -XX:HeapDumpPath=logs/heapdump.hprof

# ==========================================
# 性能调优说明
# ==========================================
# 1. 数据库连接池大小计算公式：
#    连接数 = ((核心数 * 2) + 有效磁盘数)
#    例如：8核CPU + 2个磁盘 = (8*2+2) = 18个连接
#    建议预留20-30%余量
#
# 2. 线程数配置：
#    CPU密集型：线程数 = CPU核心数 + 1
#    IO密集型：线程数 = CPU核心数 * 2
#    本项目为IO密集型，建议10-20个线程
#
# 3. Chunk大小选择：
#    - 太小：频繁提交事务，性能差
#    - 太大：内存占用高，事务时间长
#    - 建议：3000-10000，根据单条记录大小调整
#
# 4. 批量插入大小：
#    - Oracle建议：1000-5000
#    - 本项目设置：2000（平衡性能和内存）